<div class="container mx-auto px-4 py-8">
  <!-- Error Message -->
  <div *ngIf="error" class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded flex justify-between items-center">
    <span>{{ error }}</span>
    <button
      *ngIf="error?.includes('No teacher found')"
      (click)="logout()"
      class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
    >
      Return to Login
    </button>
  </div>

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">Students</h1>
    <div class="flex space-x-4">
      <button
        (click)="openAddStudentModal()"
        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        [disabled]="!currentTeacher"
      >
        Add Student
      </button>
      <button
        (click)="logout()"
        class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700"
      >
        Logout
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center py-8">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
  </div>

  <!-- Students Table -->
  <div *ngIf="!isLoading" class="bg-white shadow-md rounded-lg overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Classroom</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progress</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <tr *ngFor="let student of students">
          <td class="px-6 py-4 whitespace-nowrap">{{ student.name }}</td>
          <td class="px-6 py-4 whitespace-nowrap">{{ student.email }}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            {{ student.classroom?.name || 'Not assigned' }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-500">
              <div>Games Played: {{ student.progress?.games_played || 0 }}</div>
              <div>Average Score: {{ student.progress?.average_score || 0 }}%</div>
              <div>Time Spent: {{ student.progress?.time_spent || 0 }} hours</div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button
              (click)="openEditStudentModal(student)"
              class="text-indigo-600 hover:text-indigo-900 mr-3"
              [disabled]="!currentTeacher"
            >
              Edit
            </button>
            <button
              (click)="deleteStudent(student)"
              class="text-red-600 hover:text-red-900"
              [disabled]="!currentTeacher"
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Add/Edit Student Modal -->
  <div
    *ngIf="showModal"
    class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
  >
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
      <div class="mt-3 text-center">
        <h3 class="text-lg leading-6 font-medium text-gray-900">
          {{ isEditMode ? 'Edit Student' : 'Add New Student' }}
        </h3>
        <form [formGroup]="studentForm" (ngSubmit)="saveStudent()" class="mt-4">
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="first_name">
              First Name
            </label>
            <input
              type="text"
              id="first_name"
              formControlName="first_name"
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            />
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="last_name">
              Last Name
            </label>
            <input
              type="text"
              id="last_name"
              formControlName="last_name"
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            />
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="email">
              Email
            </label>
            <input
              type="email"
              id="email"
              formControlName="email"
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            />
          </div>
          <div class="flex justify-end mt-4">
            <button
              type="button"
              (click)="showModal = false"
              class="bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2 hover:bg-gray-400"
            >
              Cancel
            </button>
            <button
              type="submit"
              [disabled]="studentForm.invalid || !currentTeacher"
              class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50"
            >
              {{ isEditMode ? 'Update' : 'Add' }} Student
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div> 